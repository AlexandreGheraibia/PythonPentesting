#!/usr/bin/env python3 
'''
entry sample 192.168.0.0/24 0-65535
note: 
If you are scanning the IP address of the system without querying a name service, you will not be able to identify the
host name
'''
#import native lib
import sys
#import additionals libs
try:
  import nmap
except:
  sys.exit("[!] Install the nmap library: pip install python-nmap")

# Argument Validator

if len(sys.argv) != 3:
  sys.exit("Please provide two arguments the first being the targets the second the ports")
addrs = str(sys.argv[1])
ports = str(sys.argv[2])
  
#print(f'{addrs}{ports}')

scanner = nmap.PortScanner()
scanner.scan(addrs, ports)
print (scanner.command_line())
for host in scanner.all_hosts():
  if scanner[host].state()=='up':
    
    if not scanner[host].hostname():
      print(f"The host's IP address is {host} and it's hostname was not found")
    else:
      print(f"The host's IP address is {host} and it's hostname is {scanner[host].hostname()}")
    print(f"\tThe protocols used {scanner[host].all_protocols()}")
    for protocol in scanner[host].all_protocols():
      tports=scanner[host][protocol].keys()
      for port in tports:
        if(scanner[host].has_tcp(port)):
          print(f"\t\tThe port scanned {port} is tcp and {scanner[host].tcp(port)['state']}")
        elif(scanner[host].has_udp(port)):
              print(f"\t\Å§The port scanned {port} is udp and {scanner[host].tcp(port)['state']}")
    #banner grab
    
'''
print("\n"+scanner.csv())

scanner.scan(hosts='192.168.0.0/24', arguments='-n -sP -PE -PA21,23,80,3389')
hosts_list = [(x, scanner[x]['status']['state']) for x in scanner.all_hosts()]
for host in hosts_list:
  print(f"{host[0]}:{host[1]}")
'''
